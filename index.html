<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analisis Wajah & Rekomendasi Gaya Rambut</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      animation: slideIn 0.8s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      padding: 40px 30px;
      text-align: center;
      color: white;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .content {
      padding: 40px 30px;
    }

    .camera-section {
      background: #f8f9ff;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      border: 2px solid #e3f2fd;
      text-align: center;
    }

    .camera-container {
      position: relative;
      display: inline-block;
      margin: 20px 0;
    }

    #video {
      width: 100%;
      max-width: 400px;
      height: 300px;
      border-radius: 15px;
      border: 3px solid #2196F3;
      object-fit: cover;
      transform: scaleX(-1); /* Mirror effect */
    }

    #canvas {
      display: none;
    }

    .face-overlay {
      position: absolute;
      border: 3px solid #4CAF50;
      border-radius: 10px;
      background: rgba(76, 175, 80, 0.1);
      pointer-events: none;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    .control-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #4CAF50, #388E3C);
      color: white;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, #FF9800, #F57C00);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
    }

    .analysis-result {
      background: linear-gradient(135deg, #E8F5E8, #C8E6C9);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      border-left: 6px solid #4CAF50;
      display: none;
    }

    .analysis-result.show {
      display: block;
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .face-shape-detected {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2E7D32;
      margin-bottom: 15px;
      text-align: center;
    }

    .measurements {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
    }

    .measurement-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 8px 0;
      border-bottom: 1px solid rgba(46, 125, 50, 0.2);
    }

    .measurement-label {
      font-weight: 600;
      color: #2E7D32;
    }

    .measurement-value {
      color: #1B5E20;
      font-weight: 500;
    }

    .hasil-container {
      margin-top: 30px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }

    .hasil-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    .hasil-card {
      background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
      border-radius: 15px;
      padding: 30px;
      border-left: 6px solid #2196F3;
      box-shadow: 0 10px 30px rgba(33, 150, 243, 0.1);
    }

    .hasil-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .hasil-icon {
      width: 50px;
      height: 50px;
      background: #2196F3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: white;
      font-size: 1.5rem;
    }

    .hasil-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1565C0;
    }

    .hasil-text {
      font-size: 1.1rem;
      color: #0D47A1;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .tips-section {
      background: rgba(33, 150, 243, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }

    .tips-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #1976D2;
      margin-bottom: 15px;
    }

    .tips-list {
      list-style: none;
      padding-left: 0;
    }

    .tips-list li {
      background: white;
      margin-bottom: 10px;
      padding: 12px 15px;
      border-radius: 8px;
      border-left: 3px solid #2196F3;
      font-size: 1rem;
      color: #0D47A1;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #E3F2FD;
      border-top: 4px solid #2196F3;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status-message {
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 600;
      text-align: center;
    }

    .status-info {
      background: #E3F2FD;
      color: #1976D2;
      border: 2px solid #BBDEFB;
    }

    .status-success {
      background: #E8F5E8;
      color: #2E7D32;
      border: 2px solid #C8E6C9;
    }

    .status-error {
      background: #FFEBEE;
      color: #C62828;
      border: 2px solid #FFCDD2;
    }

    .manual-section {
      background: #fff3e0;
      border-radius: 15px;
      padding: 25px;
      margin-top: 30px;
      border: 2px solid #ffcc02;
    }

    .manual-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #e65100;
      margin-bottom: 15px;
      text-align: center;
    }

    .face-shapes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .face-shape-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid #FFE0B2;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .face-shape-card:hover {
      border-color: #FF9800;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.2);
    }

    .face-shape-card.selected {
      border-color: #FF9800;
      background: #FFF3E0;
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3);
    }

    .face-shape-emoji {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    .face-shape-name {
      font-weight: 600;
      color: #E65100;
      font-size: 1.1rem;
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 15px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .content {
        padding: 20px;
      }

      .camera-section {
        padding: 20px;
      }

      #video {
        max-width: 100%;
        height: 250px;
      }

      .control-buttons {
        flex-direction: column;
        align-items: center;
      }

      .btn {
        width: 200px;
      }

      .face-shapes-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🤖 Analisis Wajah AI</h1>
      <p>Deteksi otomatis bentuk wajah dan dapatkan rekomendasi gaya rambut yang sempurna</p>
    </div>

    <div class="content">
      <!-- Camera Section -->
      <div class="camera-section">
        <h2 style="color: #1976D2; margin-bottom: 20px; font-size: 1.5rem;">📸 Analisis Wajah Otomatis</h2>
        
        <div class="camera-container">
          <video id="video" autoplay muted playsinline></video>
          <canvas id="canvas"></canvas>
        </div>

        <div class="control-buttons">
          <button class="btn btn-primary" id="startCamera">🎥 Mulai Kamera</button>
          <button class="btn btn-success" id="captureBtn" disabled>📸 Ambil Foto</button>
          <button class="btn btn-warning" id="analyzeBtn" disabled>🔍 Analisis Wajah</button>
        </div>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p style="color: #2196F3; font-weight: 600;">Menganalisis bentuk wajah Anda...</p>
        </div>

        <div id="statusMessage"></div>

        <!-- Analysis Result -->
        <div class="analysis-result" id="analysisResult">
          <div class="face-shape-detected" id="detectedShape">
            🎯 Bentuk Wajah Terdeteksi: <span id="shapeResult"></span>
          </div>
          
          <div class="measurements" id="measurements">
            <h4 style="color: #2E7D32; margin-bottom: 15px;">📏 Pengukuran Wajah:</h4>
            <div class="measurement-item">
              <span class="measurement-label">Lebar Wajah:</span>
              <span class="measurement-value" id="faceWidth">-</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">Tinggi Wajah:</span>
              <span class="measurement-value" id="faceHeight">-</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">Rasio W/H:</span>
              <span class="measurement-value" id="faceRatio">-</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">Lebar Dahi:</span>
              <span class="measurement-value" id="foreheadWidth">-</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">Lebar Rahang:</span>
              <span class="measurement-value" id="jawWidth">-</span>
            </div>
            <div class="measurement-item">
              <span class="measurement-label">Tingkat Kepercayaan:</span>
              <span class="measurement-value" id="confidence">-</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Manual Selection -->
      <div class="manual-section">
        <div class="manual-title">⚙️ Atau Pilih Manual Bentuk Wajah Anda</div>
        <p style="text-align: center; color: #BF360C; margin-bottom: 20px;">
          Jika deteksi otomatis tidak akurat, Anda dapat memilih bentuk wajah secara manual
        </p>
        
        <div class="face-shapes-grid">
          <div class="face-shape-card" onclick="selectManualShape('oval')">
            <div class="face-shape-emoji">🥚</div>
            <div class="face-shape-name">Oval</div>
          </div>
          <div class="face-shape-card" onclick="selectManualShape('bulat')">
            <div class="face-shape-emoji">⭕</div>
            <div class="face-shape-name">Bulat</div>
          </div>
          <div class="face-shape-card" onclick="selectManualShape('persegi')">
            <div class="face-shape-emoji">⬜</div>
            <div class="face-shape-name">Persegi</div>
          </div>
          <div class="face-shape-card" onclick="selectManualShape('segitiga')">
            <div class="face-shape-emoji">🔺</div>
            <div class="face-shape-name">Segitiga</div>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div class="hasil-container" id="hasilContainer">
        <div class="hasil-card">
          <div class="hasil-header">
            <div class="hasil-icon">💇</div>
            <div class="hasil-title" id="hasilTitle">Rekomendasi Gaya Rambut</div>
          </div>
          <div class="hasil-text" id="hasilRekomendasi"></div>
          <div class="tips-section" id="tipsSection" style="display: none;">
            <div class="tips-title">💡 Tips Tambahan:</div>
            <ul class="tips-list" id="tipsList"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let video, canvas, ctx;
    let stream = null;
    let capturedImageData = null;
    let isAnalyzing = false;
    let currentDetectedShape = null;

    // Hairstyle recommendations data
    const rekomendasi = {
      oval: {
        text: "Selamat! Wajah oval adalah bentuk wajah yang ideal dan cocok dengan hampir semua gaya rambut. Anda memiliki fleksibilitas tinggi dalam memilih potongan rambut.",
        recommendations: "Bob panjang, layer bertingkat, pixie cut, atau bahkan rambut panjang lurus - semuanya akan terlihat menawan pada Anda!",
        tips: [
          "Coba eksperimen dengan berbagai panjang rambut",
          "Poni samping atau poni lurus keduanya cocok",
          "Gaya rambut bergelombang atau lurus sama-sama bagus",
          "Hindari gaya yang terlalu menutupi wajah"
        ]
      },
      bulat: {
        text: "Untuk wajah bulat, tujuan utama adalah menciptakan ilusi wajah yang lebih panjang dan mengurangi kesan bulat.",
        recommendations: "Gaya rambut panjang dengan layer, potongan shaggy, atau bob panjang dengan volume di bagian atas sangat cocok untuk Anda.",
        tips: [
          "Pilih rambut dengan volume di bagian atas",
          "Hindari poni tumpul yang pendek",
          "Layer panjang akan membuat wajah terlihat lebih oval",
          "Gaya side-swept atau poni samping lebih baik daripada poni tengah"
        ]
      },
      persegi: {
        text: "Wajah persegi memiliki garis rahang yang tegas. Gaya rambut yang tepat dapat melunakkan garis-garis keras ini.",
        recommendations: "Gaya rambut bergelombang, layer lembut, atau potongan yang melengkung akan menyeimbangkan struktur wajah Anda dengan sempurna.",
        tips: [
          "Pilih gaya rambut dengan gerakan dan tekstur",
          "Layer lembut di sekitar wajah sangat bagus",
          "Hindari potongan tumpul atau garis lurus",
          "Rambut keriting atau bergelombang alami cocok sekali"
        ]
      },
      segitiga: {
        text: "Wajah segitiga memiliki dagu yang lebih sempit dibandingkan dahi. Tujuannya adalah menyeimbangkan proporsi ini.",
        recommendations: "Gaya rambut dengan volume di atas seperti pompadour, pixie cut dengan volume, atau bob dengan layer atas akan sangat cocok.",
        tips: [
          "Tambahkan volume di bagian atas dan samping",
          "Poni tebal dapat menyeimbangkan dahi lebar",
          "Hindari gaya yang terlalu rata di bagian atas",
          "Layer pendek di sekitar telinga akan menambah lebar"
        ]
      }
    };

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      video = document.getElementById('video');
      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');
      
      setupEventListeners();
      showStatusMessage('Klik "Mulai Kamera" untuk memulai analisis wajah otomatis', 'info');
    });

    function setupEventListeners() {
      document.getElementById('startCamera').addEventListener('click', startCamera);
      document.getElementById('captureBtn').addEventListener('click', capturePhoto);
      document.getElementById('analyzeBtn').addEventListener('click', analyzeFace);
    }

    function showStatusMessage(message, type) {
      const statusElement = document.getElementById('statusMessage');
      statusElement.className = `status-message status-${type}`;
      statusElement.textContent = message;
    }

    async function startCamera() {
      try {
        showStatusMessage('Mengakses kamera...', 'info');
        
        stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user'
          }
        });
        
        video.srcObject = stream;
        video.onloadedmetadata = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
        };
        
        document.getElementById('startCamera').disabled = true;
        document.getElementById('captureBtn').disabled = false;
        showStatusMessage('Kamera aktif! Posisikan wajah Anda dan klik "Ambil Foto"', 'success');
        
      } catch (error) {
        console.error('Error accessing camera:', error);
        showStatusMessage('Tidak dapat mengakses kamera. Pastikan izin kamera telah diberikan.', 'error');
      }
    }

    function capturePhoto() {
      if (!stream) return;
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      
      // Draw video frame to canvas (flip horizontally to match video display)
      ctx.save();
      ctx.scale(-1, 1);
      ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
      ctx.restore();
      
      capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
      
      document.getElementById('analyzeBtn').disabled = false;
      showStatusMessage('Foto berhasil diambil! Klik "Analisis Wajah" untuk mendeteksi bentuk wajah', 'success');
    }

    function analyzeFace() {
      if (!capturedImageData || isAnalyzing) return;
      
      isAnalyzing = true;
      document.getElementById('loading').classList.add('show');
      document.getElementById('analyzeBtn').disabled = true;
      
      showStatusMessage('Menganalisis bentuk wajah...', 'info');
      
      // Simulate AI analysis (in real implementation, this would call an AI service)
      setTimeout(() => {
        performFaceAnalysis();
      }, 2000);
    }

    function performFaceAnalysis() {
      try {
        // Create image element from captured data
        const img = new Image();
        img.onload = () => {
          // Simulate face detection analysis
          const analysis = simulateFaceDetection(img);
          displayAnalysisResults(analysis);
          
          document.getElementById('loading').classList.remove('show');
          isAnalyzing = false;
          
          showStatusMessage('Analisis selesai! Lihat hasil di bawah.', 'success');
        };
        img.src = capturedImageData;
        
      } catch (error) {
        console.error('Analysis error:', error);
        document.getElementById('loading').classList.remove('show');
        isAnalyzing = false;
        showStatusMessage('Terjadi kesalahan saat menganalisis. Silakan coba lagi.', 'error');
      }
    }

    function simulateFaceDetection(img) {
      // This is a simplified simulation of face analysis
      // In a real implementation, you would use AI libraries like TensorFlow.js, Face-API.js, etc.
      
      const width = img.width;
      const height = img.height;
      
      // Generate realistic-looking measurements
      const faceWidth = Math.round(width * (0.6 + Math.random() * 0.2));
      const faceHeight = Math.round(height * (0.7 + Math.random() * 0.2));
      const ratio = (faceWidth / faceHeight).toFixed(2);
      
      const foreheadWidth = Math.round(faceWidth * (0.8 + Math.random() * 0.2));
      const jawWidth = Math.round(faceWidth * (0.7 + Math.random() * 0.3));
      
      // Determine face shape based on measurements
      let detectedShape;
      let confidence;
      
      if (ratio > 0.9) {
        detectedShape = 'bulat';
        confidence = '85%';
      } else if (ratio < 0.7) {
        detectedShape = 'oval';
        confidence = '90%';
      } else if (Math.abs(foreheadWidth - jawWidth) < faceWidth * 0.1) {
        detectedShape = 'persegi';
        confidence = '80%';
      } else {
        detectedShape = 'segitiga';
        confidence = '75%';
      }
      
      return {
        shape: detectedShape,
        confidence: confidence,
        measurements: {
          faceWidth: faceWidth + 'px',
          faceHeight: faceHeight + 'px',
          ratio: ratio,
          foreheadWidth: foreheadWidth + 'px',
          jawWidth: jawWidth + 'px'
        }
      };
    }

    function displayAnalysisResults(analysis) {
      currentDetectedShape = analysis.shape;
      
      // Show analysis results
      document.getElementById('analysisResult').classList.add('show');
      document.getElementById('shapeResult').textContent = analysis.shape.charAt(0).toUpperCase() + analysis.shape.slice(1);
      
      // Update measurements
      document.getElementById('faceWidth').textContent = analysis.measurements.faceWidth;
      document.getElementById('faceHeight').textContent = analysis.measurements.faceHeight;
      document.getElementById('faceRatio').textContent = analysis.measurements.ratio;
      document.getElementById('foreheadWidth').textContent = analysis.measurements.foreheadWidth;
      document.getElementById('jawWidth').textContent = analysis.measurements.jawWidth;
      document.getElementById('confidence').textContent = analysis.confidence;
      
      // Show hairstyle recommendations
      showHairstyleRecommendations(analysis.shape);
    }

    function selectManualShape(shape) {
      // Remove previous selection
      document.querySelectorAll('.face-shape-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      // Add selection to clicked card
      event.target.closest('.face-shape-card').classList.add('selected');
      
      // Show recommendations
      showHairstyleRecommendations(shape);
      currentDetectedShape = shape;
      
      showStatusMessage(`Bentuk wajah "${shape}" dipilih. Lihat rekomendasi di bawah!`, 'success');
    }

    function showHairstyleRecommendations(shape) {
      const hasilContainer = document.getElementById("hasilContainer");
      const hasilRekomendasi = document.getElementById("hasilRekomendasi");
      const hasilTitle = document.getElementById("hasilTitle");
      const tipsSection = document.getElementById("tipsSection");
      const tipsList = document.getElementById("tipsList");

      if (rekomendasi[shape]) {
        const data = rekomendasi[shape];
        
        // Update title
        hasilTitle.innerHTML = `💇‍♀️ Rekomendasi untuk Wajah ${shape.charAt(0).toUpperCase() + shape.slice(1)}`;
        
        // Update recommendation text
        hasilRekomendasi.innerHTML = `
          <p style="margin-bottom: 15px;"><strong>${data.text}</strong></p>
          <p style="background: rgba(255, 255, 255, 0.7); padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
            <strong>💫 Gaya yang Direkomendasikan:</strong><br>
            ${data.recommendations}
          </p>
        `;
        
        // Update tips
        tipsList.innerHTML = '';
        data.tips.forEach(tip => {
          const li = document.createElement('li');
          li.textContent = tip;
          tipsList.appendChild(li);
        });
        
        tipsSection.style.display = 'block';
        hasilContainer.classList.add("show");
        
        // Scroll to results
        setTimeout
